<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Acceso VitalHome</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('backgroundVital.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
    }
    .login-container {
      width: 300px;
      margin: 100px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      text-align: center;
    }
    .login-container img {
      width: 150px;
      margin-bottom: 20px;
    }
    .input-group {
      position: relative;
      margin-bottom: 20px;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      padding-right: 40px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 10px;
      cursor: pointer;
    }
    button {
      width: 100%;
      padding: 10px;
      background-color: #0078D7;
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .error {
      color: red;
      font-size: 0.9em;
      margin-top: -15px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <img src="LogoVitalHome.png" alt="Logo VitalHome">
    <form onsubmit="return validarFormulario()">
      <div class="input-group">
        <input type="text" id="rut" placeholder="RUT chileno" maxlength="12" oninput="formatearYValidarRUT(this)">
        <div id="rut-error" class="error"></div>
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="Contrase√±a" maxlength="8" oninput="validarCampos()">
        <span class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</span>
        <div id="password-error" class="error"></div>
      </div>
      <button id="submitBtn" type="submit" disabled>Ingresar</button>
    </form>
  </div>

  <script>
    function togglePassword() {
      const passwordInput = document.getElementById("password");
      const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
    }

    function formatearYValidarRUT(input) {
      const raw = input.value.replace(/\D/g, '');
      input.value = formatearRUT(raw);
      validarCampos();
    }

    function formatearRUT(rut) {
      if (rut.length < 2) return rut;
      const cuerpo = rut.slice(0, -1);
      const dv = rut.slice(-1);

      let cuerpoFormateado = '';
      if (cuerpo.length <= 7) {
        cuerpoFormateado = cuerpo.replace(/^(\d{1})(\d{3})(\d{3})$/, '$1.$2.$3');
      } else {
        cuerpoFormateado = cuerpo.replace(/^(\d{2})(\d{3})(\d{3})$/, '$1.$2.$3');
      }

      return `${cuerpoFormateado}-${dv}`;
    }

    function validarFormulario() {
      const rut = document.getElementById("rut").value.trim();
      const password = document.getElementById("password").value;
      const rutError = document.getElementById("rut-error");
      const passwordError = document.getElementById("password-error");

      let valido = true;

      if (!validarRUT(rut)) {
        rutError.textContent = "RUT inv√°lido. Verifica el formato y d√≠gito verificador.";
        valido = false;
      } else {
        rutError.textContent = "";
      }

      if (!validarPassword(password)) {
        passwordError.textContent = "Debe tener 8 caracteres, may√∫scula, min√∫scula, n√∫mero y s√≠mbolo.";
        valido = false;
      } else {
        passwordError.textContent = "";
      }

      return valido;
    }

    function validarCampos() {
      const rut = document.getElementById("rut").value.trim();
      const password = document.getElementById("password").value;
      const submitBtn = document.getElementById("submitBtn");

      const rutValido = validarRUT(rut);
      const passValida = validarPassword(password);

      submitBtn.disabled = !(rutValido && passValida);
    }

    function validarRUT(rut) {
      rut = rut.replace(/\./g, '').replace('-', '');
      if (rut.length < 8 || rut.length > 9) return false;

      const cuerpo = rut.slice(0, -1);
      let dv = rut.slice(-1).toUpperCase();

      let suma = 0;
      let multiplo = 2;

      for (let i = cuerpo.length - 1; i >= 0; i--) {
        suma += parseInt(cuerpo.charAt(i)) * multiplo;
        multiplo = multiplo < 7 ? multiplo + 1 : 2;
      }

      const dvEsperado = 11 - (suma % 11);
      let dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();

      return dv === dvCalculado;
    }

    function validarPassword(password) {
      const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8}$/;
      return regex.test(password);
    }
  </script>
</body>
</html>
